[tox]
envlist =
    py310-sphinx{7,8}
    py312-sphinx{7,8,9}
    lint
    type
    docs

# Limit parallel execution to avoid resource issues
skipsdist = False
isolated_build = True

[testenv]
deps =
    pytest>=7.0
    pytest-cov>=4.0
    coverage[toml]>=7.0
    sphinx7: sphinx>=7.0,<8.0
    sphinx8: sphinx>=8.0,<9.0
    sphinx9: sphinx>=9.0,<10.0

commands =
    pytest {posargs}

[testenv:lint]
description = Run code quality checks
deps =
    ruff>=0.1.0
skip_install = True
commands =
    ruff check lightbox tests

[testenv:type]
description = Type checking with mypy
deps =
    mypy>=1.0
    types-docutils
commands =
    mypy lightbox

[testenv:docs]
description = Build documentation
changedir = {toxinidir}
deps =
    sphinx>=7.0
commands =
    sphinx-build -W -b html docs _build/html
    sphinx-build -W -b latex docs _build/latex

[testenv:coverage]
description = Generate coverage report
deps =
    {[testenv]deps}
    coverage[toml]>=7.0
commands =
    coverage run -m pytest
    coverage report
    coverage html

